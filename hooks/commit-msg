#!/bin/bash
# Commit message hook for PM projects
# This hook validates commit message format

set -e

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

echo "📝 Validating commit message format..."

# Check if commit message is empty
if [[ -z "${commit_msg// }" ]]; then
    echo "❌ Empty commit message"
    exit 1
fi

# Check minimum length
if [[ ${#commit_msg} -lt 10 ]]; then
    echo "❌ Commit message too short (minimum 10 characters)"
    echo "Current: ${#commit_msg} characters"
    exit 1
fi

# Check maximum length of first line
first_line=$(echo "$commit_msg" | head -n1)
if [[ ${#first_line} -gt 72 ]]; then
    echo "❌ First line too long (maximum 72 characters)"
    echo "Current: ${#first_line} characters"
    exit 1
fi

# Check for conventional commit format (optional)
if [[ "$commit_msg" =~ ^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?:\ .+ ]]; then
    echo "✅ Conventional commit format detected"
else
    echo "💡 Consider using conventional commit format: <type>(<scope>): <description>"
fi

echo "✅ Commit message validation passed!"